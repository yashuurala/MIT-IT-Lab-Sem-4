1)
CREATE OR REPLACE TRIGGER on_accident
AFTER  INSERT OR UPDATE on participated
For each row
	declare
	p_name person.name%type;
	p_id person.driver_id%type;
	p_addr person.Address%type;
BEGIN
	if INSERTING then
		SELECT driver_id, name, address
		INTO p_id, p_name, p_addr
		FROM person  
		WHERE driver_id = :new.driver_id;
		dbms_output.put_line('name : '||p_name||' driver id : '||p_id||' address : '||p_addr);
	END if;
END;
/

insert into PERSON values('KA23 1234567', 'AAAA', 'MANIPAL');
insert into PARTICIPATED values('KA23 1234567', 'KA21 S3514', 22, 66000);

2)

CREATE OR REPLACE function acc2(year1 in varchar) return number as
counter integer;
BEGIN
	SELECT count(*) INTO counter 
	FROM ACCIDENT a 
	WHERE extract(year FROM accd_date)=year1;
	dbms_output.put_line('Total Accidents Function');
	return counter;
END;
/

set serveroutput on;
declare year integer;
BEGIN
year:=acc2(2020);
dbms_output.put_line(year);
END;
/

declare n number(2);
BEGIN
n:=acc2(2000);
dbms_output.put_line('No of accidents: '||n);
END;
/

3)
create or replace procedure damage(did_in in varchar2,year_in in varchar2)
as tot_dmg_amt integer;
begin
select sum(damage_amount) into tot_dmg_amt
from participated
where report_number in (select report_number
from accident
where extract(year from accd_date)=year_in)
and driver_id=did_in;
DBMS_OUTPUT.PUT_LINE(tot_dmg_amt);
end;
/

execute damage('KA20 2019324','2020');

4)
CREATE OR REPLACE procedure acc1(loc in varchar) IS
rno INTEGER;
BEGIN
For item in(
SELECT * FROM ACCIDENT WHERE ACCIDENT.location=loc
) LOOP
dbms_output.put_line('Report Number : '||item.report_number);
dbms_output.put_line('Accident Date : '||item.accd_date);
dbms_output.put_line('Location : '||item.location);
END LOOP;
END;
/

set serveroutput on;
declare
BEGIN
acc1('UDUIPI');
END;
/
